<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>LCDR - Wyniki Live</title>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
    }

    h1 {
      color: #00e676;
      margin-bottom: 30px;
    }

    .section {
      margin-bottom: 40px;
    }

    .fi-title {
      font-size: 22px;
      color: #00e676;
      margin-bottom: 15px;
    }

    .entry {
      background-color: #1e1e1e;
      border-left: 4px solid #00e676;
      padding: 10px 15px;
      margin-bottom: 10px;
      border-radius: 6px;
    }

    .entry strong {
      color: #ffffff;
    }

    .stat-line {
      font-size: 14px;
      margin-left: 10px;
    }
  </style>
</head>
<body>
  <h1>LCDR - Wyniki z dzisiejszego dnia</h1>
  <div id="data-container">Ładowanie danych...</div>

  <script>
    const TODAY = '2025-05-15';
    const SHEETS = [
      { url: 'https://docs.google.com/spreadsheets/d/1vTXdlq02wklbShCqO4st2FuEURvqcXpMQPmhFx_bB3C4efqANIbPKCYOMA9BNzdn5ceQz3wasIJXw05/gviz/tq?gid=0', label: 'FI #1' },
      { url: 'https://docs.google.com/spreadsheets/d/1vTXdlq02wklbShCqO4st2FuEURvqcXpMQPmhFx_bB3C4efqANIbPKCYOMA9BNzdn5ceQz3wasIJXw05/gviz/tq?gid=193025884', label: 'FI #2' }
    ];

    async function fetchSheetData(url) {
      const response = await fetch(url);
      const text = await response.text();
      const json = JSON.parse(text.substring(47).slice(0, -2));
      return json.table;
    }

    function renderSection(data, label) {
      const section = document.createElement('div');
      section.classList.add('section');

      const title = document.createElement('div');
      title.classList.add('fi-title');
      title.textContent = label;
      section.appendChild(title);

      const cols = data.cols.map(col => col.label);
      const dateIndex = cols.findIndex(col => col.toLowerCase().includes('data') || col.toLowerCase().includes('date'));

      data.rows.forEach(row => {
        if (!row.c[dateIndex]) return;
        const rowDate = row.c[dateIndex].f || row.c[dateIndex].v;
        if (!rowDate.includes(TODAY)) return;

        const entry = document.createElement('div');
        entry.classList.add('entry');

        row.c.forEach((cell, i) => {
          if (cell && cols[i] !== 'Data') {
            const line = document.createElement('div');
            line.classList.add('stat-line');
            line.innerHTML = `<strong>${cols[i]}:</strong> ${cell.f || cell.v}`;
            entry.appendChild(line);
          }
        });

        section.appendChild(entry);
      });

      return section;
    }

    async function loadAndRender() {
      const container = document.getElementById('data-container');
      container.innerHTML = '';

      for (const sheet of SHEETS) {
        const data = await fetchSheetData(sheet.url);
        const section = renderSection(data, sheet.label);
        container.appendChild(section);
      }
    }

    loadAndRender();
    setInterval(loadAndRender, 2 * 60 * 1000); // Odśwież co 2 minuty
  </script>
</body>
</html>
