<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>LCDR WYNIKI LIVE</title>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: 'Segoe UI', sans-serif;
      padding: 30px;
    }

    h1 {
      color: #00e676;
      margin-bottom: 30px;
    }

    .section {
      margin-bottom: 40px;
    }

    .fi-title {
      font-size: 20px;
      color: #00e676;
      margin-bottom: 15px;
    }

    .person {
      margin-bottom: 20px;
      padding-left: 10px;
      border-left: 3px solid #00e676;
    }

    .person-name {
      font-weight: bold;
      font-size: 16px;
      margin-bottom: 5px;
    }

    .stat {
      margin-left: 10px;
      font-size: 14px;
      line-height: 1.4em;
    }
  </style>
</head>
<body>
  <h1>LCDR WYNIKI LIVE</h1>
  <div id="data-container">Ładowanie danych...</div>

  <script>
    const SPREADSHEET_ID = '1vTXdlq02wklbShCqO4st2FuEURvqcXpMQPmhFx_bB3C4efqANIbPKCYOMA9BNzdn5ceQz3wasIJXw05';
    const GID = '1731536831';

    async function fetchData() {
      const url = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?gid=${GID}`;
      try {
        const response = await fetch(url);
        const text = await response.text();
        const jsonData = JSON.parse(text.substring(47, text.length - 2));
        return jsonData.table;
      } catch (error) {
        console.error('Błąd podczas pobierania danych:', error);
        return null;
      }
    }

    function renderData(table) {
      const container = document.getElementById('data-container');
      container.innerHTML = '';

      const rows = table.rows;
      const cols = table.cols.map(col => col.label);

      let currentSection = null;
      let sectionElement = null;

      rows.forEach(row => {
        const firstCell = row.c[0] ? row.c[0].v : '';
        if (firstCell.startsWith('FI #')) {
          currentSection = firstCell;
          sectionElement = document.createElement('div');
          sectionElement.classList.add('section');

          const title = document.createElement('div');
          title.classList.add('fi-title');
          title.textContent = currentSection;
          sectionElement.appendChild(title);

          container.appendChild(sectionElement);
        } else if (firstCell && firstCell !== 'Name' && firstCell !== 'Suma całkowita') {
          const person = document.createElement('div');
          person.classList.add('person');

          const name = document.createElement('div');
          name.classList.add('person-name');
          name.textContent = firstCell;
          person.appendChild(name);

          for (let i = 1; i < row.c.length; i++) {
            const cell = row.c[i];
            if (cell && cell.v !== null && cell.v !== '') {
              const stat = document.createElement('div');
              stat.classList.add('stat');
              stat.textContent = `- ${cols[i]}: ${cell.v}`;
              person.appendChild(stat);
            }
          }

          if (sectionElement) {
            sectionElement.appendChild(person);
          }
        }
      });
    }

    async function loadData() {
      const table = await fetchData();
      if (table) {
        renderData(table);
      } else {
        document.getElementById('data-container').textContent = 'Nie udało się załadować danych.';
      }
    }

    loadData();
    setInterval(loadData, 2 * 60 * 1000); // Odśwież co 2 minuty
  </script>
</body>
</html>
